
# 美容室予約管理アプリ MVP 要件定義書

## 1. 目的
本ドキュメントは、美容室向け「予約管理アプリ」の **最小実用プロダクト（MVP）** を定義する。  
決済・ポイント・CRM拡張を排除し、**予約機能に特化**して短期間でリリース可能なスコープを明示する。

---

## 2. スコープ

| 区分 | 内容 |
|------|------|
| In-Scope | 予約登録・変更・キャンセル / スタッフシフト管理 / メニュー・オプション管理 / 顧客基本情報管理 / リマインダー通知 / セキュリティ・監査ログ・バックアップ |
| Out-of-Scope | 決済処理 / ポイント・クーポン / 詳細カルテ / 外部カレンダー連携 / テナント・多店舗管理 / マーケティング機能 |

---

## 3. 用語定義
| 用語 | 定義 |
|------|------|
| メニュー | カット・カラー等の基本施術。**所要時間・価格**を必ず持つ |
| オプション | 基本メニューに追加して選択する施術（トリートメント等）。**追加所要時間・追加価格**を持つ |
| スタッフ | 施術を担当する従業員。対応可能な「ラベル」を複数持つ |
| ラベル | 「メンズカット」「ブリーチ」など、メニューに付与する分類タグ |
| 予約枠 | スタッフの勤務時間内で、メニュー＋オプションの合計所要時間を確保した時間帯 |
| 顧客 | 予約を行うユーザー。氏名・連絡先 (電話 or メール) を保持 |
| ステータス | 予約の状態。仮予約／確定／施術中／完了／キャンセル |

---

## 4. 機能要件

### 4.1 予約管理
| ID | 要件 | 優先度 |
|----|------|--------|
| FR-100 | メニュー → オプション → スタッフ → 日付 → 時間の順に予約 | ★★★ |
| FR-110 | 予約期間は **翌日〜90日後** まで選択可能 | ★★★ |
| FR-120 | 当日予約は不可 | ★★★ |
| FR-130 | 同一時間帯に同一スタッフへ重複予約を禁止 | ★★★ |
| FR-140 | 予約ステータスを保持し履歴を残す | ★★★ |
| FR-150 | 顧客／スタッフ双方へ予約確定・変更・キャンセル時のリアルタイム通知 | ★★☆ |
| FR-160 | 24h前・2h前にリマインダー通知 (メール/SMS/PWA) | ★★☆ |
| FR-170 | 管理画面からの予約新規登録・変更・削除 | ★★★ |

### 4.2 スタッフ管理
| ID | 要件 | 優先度 |
|----|------|--------|
| FR-200 | スタッフごとに勤務予定時間（開始・終了）を日単位で登録 | ★★★ |
| FR-210 | スタッフに対応ラベルを複数設定できる | ★★★ |
| FR-220 | 勤務時間外および非対応メニューのスタッフは予約候補から除外 | ★★★ |

### 4.3 メニュー・オプション管理
| ID | 要件 | 優先度 |
|----|------|--------|
| FR-300 | メニューは所要時間・価格・ラベルを必須入力とする | ★★★ |
| FR-310 | オプションは追加所要時間・追加価格を持ち、基本メニューと組み合わせて所要時間を算出 | ★★★ |
| FR-320 | 管理画面でメニュー／オプションを CRUD できる | ★★★ |

### 4.4 顧客管理
| ID | 要件 | 優先度 |
|----|------|--------|
| FR-400 | 予約時に氏名・電話番号・メールアドレスを登録必須 | ★★★ |
| FR-410 | 顧客プロフィールと予約履歴を一覧表示 | ★★☆ |

### 4.5 通知
| ID | 要件 | 優先度 |
|----|------|--------|
| FR-500 | 通知チャネルの ON/OFF を顧客ごとに設定 | ★★☆ |
| FR-510 | 失敗した通知を再送可能にする | ★★☆ |

---

## 5. 非機能要件 (NFR)

| ID | 項目 | 要件 |
|----|------|------|
| NFR-100 | セキュリティ | ・通信は HTTPS / TLS 1.3 以上<br>・顧客情報を暗号化 at-rest (AES-256)<br>・Firebase Auth または同等の JWT 認証 |
| NFR-110 | 監査ログ | 予約・顧客・メニュー・スタッフの CRUD 操作をユーザーID・IP・タイムスタンプ付きで保存 (90日以上保持) |
| NFR-120 | バックアップ | 毎日 03:00 JST に自動フルバックアップ、保持期間30日。リストア手順を手順書化 |
| NFR-130 | 可用性 | 目標稼働率 99.5% 以上 (月間ダウンタイム ≤ 3h 39m) |
| NFR-140 | パフォーマンス | スタッフ10名・1日100件予約でも予約検索API応答 <200 ms (P95) |

### 5.1 モバイル性能要件
| ID | 項目 | 要件 |
|----|------|------|
| NFR-150 | モバイル性能 | • JSバンドル <70KB (gzip)<br>• LCP <2.5s<br>• CLS <0.1<br>• 片手操作対応 |

---

## 6. 予約フロー (UI 視点)

### 6.1 モバイルファースト設計
**目標**: スマートフォンで片手操作、最大4タップで予約完了

**情報アーキテクチャ**:
```
ホーム (予約履歴 + FAB)
 ↓ タップ
Step 1: サービス選択 (Bottom Sheet)
 ↓ 自動保存・スワイプ閉じ
Step 2: 日時選択 (Bottom Sheet) 
 ↓
Step 3: スタイリスト選択 (Bottom Sheet)
 ↓
Step 4: 確認・予約完了 (Dialog)
```

### 6.2 画面別UI要件
| 画面 | UI要素 | UX要件 |
|------|--------|--------|
| **ホーム** | • 直近3件の予約履歴<br>• FAB「＋予約」ボタン | • 1タップでリブック<br>• FABは親指範囲（右下） |
| **サービス選択** | • アイコン+名前+時間のカード<br>• 2列グリッド | • タップ領域≥48px<br>• 選択カードをハイライト |
| **日時選択** | • 横スクロール7日カレンダー<br>• 利用可能時間チップ | • クイックフィルタ「最短」「夕方」等 |
| **スタイリスト** | • 「指定なし」「前回と同じ」ショートカット<br>• スタイリストカード+★評価 | • 追加料金をカードに表示 |
| **確認** | • 予約サマリー+合計金額<br>• 予約ボタン(Primary)<br>• 編集ボタン(Secondary) | • ボタンは画面下部固定<br>• 100ms以内のフィードバック |

### 6.3 従来フロー (管理画面/デスクトップ向け)
1. **メニュー選択画面**  
2. **オプション選択** → 所要時間自動再計算  
3. **スタッフ選択** (対応ラベルで自動フィルタ)  
4. **日付選択** (翌日〜90日)  
5. **時間選択** (勤務時間内の空き枠のみ表示)  
6. **顧客情報入力 / ログイン**  
7. **確認 → 予約確定** → 通知送信

### 6.4 スムーズな体験のための機能
- **1タップリブック**: 過去予約を右スワイプで次回枠に自動セット
- **スケルトンローダー**: 待ち時間の体感を短縮
- **リッチプッシュ通知**: 前日・当日朝のリマインダー（オプトイン）
- **オフライン対応**: ローカル保存→再接続時同期
- **アクセシビリティ**: セマンティックHTML、コントラスト比4.5:1以上  

---

## 7. エンティティ定義 (概要)

| Entity | 主キー | 主要属性 |
|--------|--------|---------|
| `Menu` | menu_id | name, duration_min, price, labels[] |
| `Option` | option_id | name, add_duration_min, add_price |
| `Staff` | staff_id | name, labels[] |
| `Shift` | shift_id | staff_id (FK), date, start_at, end_at |
| `Customer` | customer_id | name, phone, email |
| `Reservation` | reservation_id | customer_id, staff_id, menu_id, option_ids[], start_at, end_at, status |

---

## 8. 将来拡張 (参考)

- オンライン決済連携  
- ポイント／クーポン  
- キャンセル繰り上げ待ちリスト  
- AI シフト自動生成  

---

## 9. 変更履歴

| 版 | 日付 | 変更概要 | 作成／更新者 |
|----|------|----------|--------------|
| v0.1 | 2025-06-29 | 新規作成 | ChatGPT |
